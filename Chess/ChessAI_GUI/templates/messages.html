<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat with {{ friend_nickname }}</title>
    <!-- Google Fonts for a modern look -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/friend_profile.css') }}">
  <!-- GSAP Animation Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/messages.css') }}">
  <meta name="csrf-token" content="{{ csrf_token() }}">
</head>
<body>
    <header>
        <div class="container">
            <h1 class="page-title">Chat with {{ friend_nickname }}</h1>
            <nav>
            <ul>
                {% if not session.get('user') %}
                    <li><a href="{{ url_for('forgot_password') }}">Forgot password</a></li>
                {% endif %}
                <li><a href="{{ url_for('about') }}">About</a></li>
                {% if session.get('user') %}
                    <!-- Show user settings if logged in -->
                    <li><a href="{{ url_for('user_settings') }}">Settings</a></li>
                    <li><a href="{{ url_for('logout') }}">Logout</a></li>
                    <!-- If current_user exists and is admin, show admin dashboard link -->
                    {% if session.get('role') == "admin" %}
                        <li><a href="{{ url_for('admin_dashboard') }}">Admin Page</a></li>
                    {% endif %}
                    
                    {% if session.get('role') in ['admin', 'member'] %}
                        <li><a href="{{ url_for('clan_page') }}">Clan</a></li>
                    {% endif %}
                
                {% else %}
                    <li><a href="{{ url_for('login') }}">Login</a></li>
                    <li><a href="{{ url_for('sign_up') }}">Sign up</a></li>
                {% endif %}
                <li><a href="{{ url_for('home') }}">Home</a></li>
            </ul>
        </nav>
        </div>
    </header>

  <div class="chat-container">
    <h2>Chat with {{ friend_nickname }}</h2>
    <div class="chat-inner">
      <div class="messages" id="messagesBox">
        {% for msg in messages %}
          <div class="message-box {% if msg.from == current_user %}sent{% else %}received{% endif %}">
            <div class="meta">{{ msg.from }} | {{ msg.timestamp }}</div>
            <div class="text">{{ msg.message }}</div>
          </div>
        {% endfor %}
      </div>
      <div class="send-box">
        <textarea id="messageInput" placeholder="Type your message..."></textarea>
        <button id="sendBtn" data-friend="{{ friend_nickname }}">Send</button>
      </div>
    </div>
    <a href="{{ url_for('profile', friend_nickname=friend_nickname) }}" class="back-link">‚Üê Back to Profile</a>
  </div>

  <script src="{{ url_for('static', filename='js/messages.js') }}"></script>
</body>
</html>
